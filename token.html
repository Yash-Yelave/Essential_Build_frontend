<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Token - CureConnect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/tailwind-config.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8F9FA; }
    </style>
</head>
<body class="text-gray-800 antialiased min-h-screen flex flex-col justify-center items-center p-5">
    <div class="max-w-md w-full">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-primary mb-2">Your Token</h2>
            <p class="text-gray-500">Please wait for your turn.</p>
        </div>

        <div class="bg-white rounded-2xl shadow-xl p-8 mb-6 text-center">
            <div id="tokenContent">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
                <p class="mt-4 text-gray-500">Loading status...</p>
            </div>
        </div>

        <div class="text-center">
            <a href="dashboard.html" class="inline-block py-3 px-8 rounded-xl font-semibold border-2 border-primary text-primary hover:bg-primary/5 transition-all active:scale-95">
                Back to Dashboard
            </a>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/appointment.js"></script>
    <script>
        if (!Auth.isLoggedIn()) window.location.href = 'login.html';

        async function updateTokenStatus() {
            const container = document.getElementById('tokenContent');
            try {
                const status = await Appointment.getTokenStatus();
                
                if (status && status.token_number) {
                    container.innerHTML = `
                        <h5 class="text-gray-500 font-medium mb-4 text-lg">Dr. ${status.doctor_name}</h5>
                        <div class="text-6xl font-extrabold text-primary bg-blue-50 py-6 rounded-2xl mb-6">${status.token_number}</div>
                        <h3 class="text-2xl font-bold ${getStatusColorClass(status.status)} uppercase tracking-wide">${status.status}</h3>
                        <p class="text-gray-400 mt-4 font-medium">
                            Appointment Time: ${status.appointment_time}
                        </p>
                    `;
                } else {
                    container.innerHTML = `
                        <p class="text-gray-500 mb-4 text-lg">No active token found for today.</p>
                        <a href="select-doctor.html" class="inline-block py-2 px-6 rounded-lg bg-primary text-white font-semibold hover:bg-blue-600 transition-colors">Book Appointment</a>
                    `;
                }
            } catch (error) {
                console.error(error);
            }
        }

        function getStatusColorClass(status) {
            if (!status) return 'text-gray-400';
            status = status.toLowerCase();
            if (status === 'completed') return 'text-success';
            if (status === 'called') return 'text-primary';
            if (status === 'waiting') return 'text-yellow-500';
            return 'text-gray-400';
        }

        // Initial load
        updateTokenStatus();

        // Refresh every 15 seconds
        setInterval(updateTokenStatus, 15000);
    </script>
</body>
</html>
